<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç•™è¨€å¢™</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}
body{background:#f7f7fa;padding:12px;max-width:600px;margin:0 auto}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:8px}
.title{font-size:20px;font-weight:600;color:#222}
.btn{padding:8px 12px;border:none;border-radius:10px;font-size:14px;font-weight:500;cursor:pointer;white-space:nowrap}
.btn-primary{background:#409eff;color:#fff}
.btn-danger{background:#f56756;color:#fff}
.publish-card{background:#fff;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
.publish-card input,.publish-card textarea{width:100%;padding:12px 14px;border:1px solid #eee;border-radius:12px;margin-bottom:10px;outline:none;font-size:15px;background:#fafafa;transition:border .2s}
.publish-card input:focus,.publish-card textarea:focus{border-color:#409eff}
.nick-preview{font-size:13px;color:#409eff;margin:-5px 0 10px;display:none}
.word-tip{font-size:13px;color:#666;margin:0 0 10px}
.publish-card textarea{min-height:100px;resize:none}
.publish-card button{width:100%;padding:12px;background:#409eff;color:#fff;border:none;border-radius:12px;font-weight:500;cursor:pointer;transition:opacity .2s}
.publish-card button:hover{opacity:.9}
.message-wall{display:flex;flex-direction:column;gap:12px}
.message-item{background:#fff;border-radius:16px;padding:14px;position:relative;box-shadow:0 2px 8px rgba(0,0,0,.04);display:flex;gap:12px}
.message-item.top{border:1px solid #ffd43b;background:#fffdf5}
.avatar{width:42px;height:42px;border-radius:50%;object-fit:cover;background:#eee;flex-shrink:0}
.msg-right{flex:1}
.name{font-weight:600;font-size:15px;color:#222;margin-bottom:6px;display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.top-tag{background:#FF7D00;color:#fff;font-size:11px;padding:2px 6px;border-radius:4px;font-weight:bold}
.tag-item{font-size:11px;padding:2px 6px;border-radius:4px;font-weight:bold;color:#fff}
.content{font-size:15px;line-height:1.5;color:#333;word-break:break-all}
.qq-time-ip{font-size:12px;color:#999;display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:8px}
.admin-actions{position:absolute;top:10px;right:10px;display:none;gap:4px}
.act-del{background:#f56756;width:26px;height:22px;font-size:10px;border:none;border-radius:4px;color:#fff;cursor:pointer}
.act-block{background:#ff9f43;width:26px;height:22px;font-size:10px;border:none;border-radius:4px;color:#fff;cursor:pointer}
.act-top{background:#409eff;width:26px;height:22px;font-size:10px;border:none;border-radius:4px;color:#fff;cursor:pointer}
.act-edit{background:#722ed1;width:26px;height:22px;font-size:10px;border:none;border-radius:4px;color:#fff;cursor:pointer}
.edit-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center;z-index:99999}
.edit-box{background:#fff;width:90%;max-width:400px;border-radius:16px;padding:20px}
.edit-box h4{margin-bottom:12px;font-size:16px}
.edit-box input,.edit-box textarea{width:100%;padding:10px;margin-bottom:10px;border:1px solid #eee;border-radius:8px;outline:none}
.edit-btns{display:flex;gap:10px;margin-top:10px}
.edit-btns button{flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer}
.btn-save{background:#409eff;color:#fff}
.btn-cancel{background:#f1f1f1;color:#333}
.backend-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.3);display:none;z-index:9999}
.backend-box{background:#fff;width:100%;height:100%;display:flex;flex-direction:column}
.backend-header{background:#409eff;color:#fff;padding:16px;display:flex;justify-content:space-between;align-items:center}
.backend-close{background:none;border:none;color:#fff;font-size:20px;cursor:pointer}
.backend-body{flex:1;padding:16px;overflow-y:auto;background:#f7f7fa}
.section{background:#fff;border-radius:14px;padding:16px;margin-bottom:14px}
.section h4{margin-bottom:12px;font-size:16px}
.set-row{display:flex;flex-direction:column;gap:6px;margin-bottom:12px}
.set-row span{font-size:14px;color:#555}
.set-row input{padding:10px 12px;border:1px solid #eee;border-radius:10px;font-size:15px;background:#fafafa}
textarea{width:100%;height:100px;padding:12px;border:1px solid #eee;border-radius:10px;font-size:14px;background:#fafafa;resize:none}
.save-btn{width:100%;padding:11px;background:#409eff;color:#fff;border:none;border-radius:10px;margin-top:6px;cursor:pointer}
.black-item{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:#fafafa;border-radius:10px;margin-bottom:8px}
.unblock{background:#409eff;color:#fff;border:none;padding:5px 9px;border-radius:6px;font-size:12px;cursor:pointer}
</style>
</head>
<body>

<div class="header">
  <div class="title">ğŸ’¬ ç•™è¨€å¢™</div>
  <div style="display:flex;gap:6px;">
    <button class="btn btn-primary" onclick="openBackend()">ç®¡ç†</button>
    <button class="btn btn-danger" id="logoutBtn" style="display:none;" onclick="logoutAdmin()">é€€å‡ºç™»å½•</button>
  </div>
</div>

<div class="publish-card">
  <input id="qq" placeholder="è¯·è¾“å…¥QQå·" autocomplete="off">
  <div class="nick-preview" id="nickPreview">æ­£åœ¨è·å–æ˜µç§°...</div>
  <div class="word-tip" id="nickWordTip"></div>
  <textarea id="content" placeholder="æƒ³è¯´ç‚¹ä»€ä¹ˆ..."></textarea>
  <div class="word-tip" id="contentWordTip"></div>
  <button onclick="postMsg()">å‘å¸ƒç•™è¨€</button>
</div>

<div class="message-wall" id="msgWall"></div>

<div class="edit-modal" id="editModal">
  <div class="edit-box">
    <h4>ç¼–è¾‘ç•™è¨€</h4>
    <input id="edit_name" placeholder="æ˜µç§°">
    <input id="edit_qq" placeholder="QQ">
    <input id="edit_time" placeholder="æ—¶é—´">
    <input id="edit_ip" placeholder="IP">
    <textarea id="edit_content" rows="4" placeholder="å†…å®¹"></textarea>
    <input id="edit_tags" placeholder="æ ¼å¼ï¼šæç¬‘:#ff5722 æ—¥å¸¸:#1890ff">
    <div class="edit-btns">
      <button class="btn-cancel" onclick="closeEdit()">å–æ¶ˆ</button>
      <button class="btn-save" onclick="saveEdit()">ä¿å­˜</button>
    </div>
  </div>
</div>

<div class="backend-modal" id="backendModal">
  <div class="backend-box">
    <div class="backend-header">
      <h3>ç®¡ç†åå°</h3>
      <button class="backend-close" onclick="closeBackend()">Ã—</button>
    </div>
    <div class="backend-body">
      <div class="section">
        <h4>åŸºç¡€è®¾ç½®</h4>
        <div class="set-row"><span>æœ€å°‘å­—æ•°</span><input id="set_min"></div>
        <div class="set-row"><span>æœ€å¤šå­—æ•°</span><input id="set_max"></div>
        <div class="set-row"><span>æ˜µç§°æœ€å¤§å­—æ•°</span><input id="set_nick_max"></div>
        <div class="set-row"><span>å‘è¨€é—´éš”(ç§’)</span><input id="set_cd"></div>
        <div class="set-row"><span>æ¨é€æ ‡é¢˜</span><input id="set_push_title" placeholder="ä¸ºç©ºåˆ™ä½¿ç”¨é»˜è®¤æ ‡é¢˜"></div>
        <button class="save-btn" onclick="saveSetting()">ä¿å­˜è®¾ç½®</button>
      </div>

      <div class="section" style="background:#e6f7ff;">
        <h4>ğŸ”§ æ¨é€åŠŸèƒ½</h4>
        <div class="set-row"><span>æ¨é€å†…å®¹</span><textarea id="pushContent" placeholder="è¯·è¾“å…¥è¦æ¨é€çš„å†…å®¹"></textarea></div>
        <div class="set-row"><button class="save-btn" style="background:#52c41a" onclick="manualPush()">ç«‹å³æ‰‹åŠ¨æ¨é€</button></div>
        <div style="display:flex;gap:8px;margin-top:8px;">
          <div style="flex:1;"><span>æ¯æ—¥å®šç‚¹å°æ—¶ï¼ˆ0-23ï¼‰</span><input type="number" id="pushHour" min="0" max="23"></div>
          <div style="flex:1;"><span>æ¯æ—¥å®šç‚¹åˆ†é’Ÿï¼ˆ0-59ï¼‰</span><input type="number" id="pushMin" min="0" max="59"></div>
        </div>
        <div style="display:flex;gap:6px;margin-top:8px;">
          <button class="save-btn" style="background:#ff9f43;flex:1" onclick="startDailyPush()">å¯åŠ¨æ¯æ—¥æ¨é€</button>
          <button class="save-btn" style="background:#f56756;flex:1" onclick="stopDailyPush()">åœæ­¢æ¯æ—¥æ¨é€</button>
        </div>
        <div style="margin-top:8px;">
          <button class="save-btn" style="background:#722ed1;" onclick="savePushConfigOnly()">ä¿å­˜æ¨é€é…ç½®</button>
        </div>
        <div style="font-size:12px;color:#666;margin-top:8px;">è®¿é—®æ¨é€é“¾æ¥ï¼š<span id="autoPushUrl"></span></div>
      </div>

      <div class="section">
        <h4>æ•æ„Ÿè¯</h4>
        <textarea id="set_bad"></textarea>
        <button class="save-btn" onclick="saveBadWords()">ä¿å­˜æ•æ„Ÿè¯</button>
      </div>
      <div class="section">
        <h4>ä¿®æ”¹å¯†ç </h4>
        <div class="set-row"><span>æ–°å¯†ç </span><input id="new_pwd"></div>
        <button class="save-btn" onclick="saveNewPwd()">ä¿å­˜å¯†ç </button>
      </div>
      <div class="section">
        <h4>å·²æ‹‰é»‘</h4>
        <div id="blackList"></div>
      </div>
    </div>
  </div>
</div>

<script>
// ====================== GitHub é…ç½® ======================
const GH_OWNER   = "linshanghui";
const GH_REPO    = "lahz-grjs";
const GH_BRANCH  = "main";
const FILE_CONFIG = "msg_config.json";
const FILE_DATA   = "msg_data.json";
const FILE_BLACK  = "msg_black.json";
// ==========================================================

let adminPwd = localStorage.getItem('adminPwd') || "123456";
localStorage.setItem('adminPwd', adminPwd);

const defaultConfig = {
  minWords:5, maxWords:200, nickMaxWords:20, cooldown:30,
  badWords:"æ“\nå‚»é€¼\nå¦ˆçš„\nåƒåœ¾\næ»š",
  pushTitle:"ğŸ“¢ ç•™è¨€å¢™æœ‰äººç•™è¨€å•¦",
  pushContent:"", pushHour:22, pushMin:23
};

let config    = {...defaultConfig};
let msgList   = JSON.parse(localStorage.getItem('msgList')) || [];
let blackList = JSON.parse(localStorage.getItem('blackList')) || [];

let pushConfig = {
  get content(){return config.pushContent||""},
  get hour(){return config.pushHour||22},
  get min(){return config.pushMin||23}
};

let lastPost=0, isLogin=false, userIP="127.0.0.1", currentNickname="";
let dailyTimer=null, editRealIndex=-1;
const QMSG_KEY="bccdf562f8785c98f39b6cd53fe6ac32";
const tagColors=["#13c2c2","#722ed1","#eb2f96","#1890ff","#52c41a","#faad14","#f5222d","#fa8c16"];

// åªè¯»å–ï¼Œä¸å†™
async function loadFromGitHub(filename){
  try{
    const r = await fetch(`https://raw.githubusercontent.com/${GH_OWNER}/${GH_REPO}/${GH_BRANCH}/${filename}`);
    if(r.ok) return await r.json();
  }catch(e){}
  return filename === FILE_CONFIG ? {...defaultConfig} : [];
}

// å·¥å…·å‡½æ•°
function getFixedColor(s){let h=0;for(let i=0;i<s.length;i++)h=s.charCodeAt(i)+(h<<5)-h;return tagColors[Math.abs(h)%tagColors.length]}
function parseTags(t){if(!t)return[];return t.split(/\s+/).filter(x=>x.trim()).map(p=>p.includes(":")?{text:p.split(":")[0].trim(),color:p.split(":")[1].trim()}:{text:p.trim(),color:getFixedColor(p)})}
function updateNickWordTip(){document.getElementById("nickWordTip").innerText=`æ˜µç§°å·²è¾“å…¥ ${document.getElementById("qq").value.length} / ${config.nickMaxWords}`}
function updateContentWordTip(){document.getElementById("contentWordTip").innerText=`å†…å®¹å·²è¾“å…¥ ${document.getElementById("content").value.length} / ${config.maxWords}`}
function refreshAllWordTip(){updateNickWordTip();updateContentWordTip()}
function cutNick(n){return n.length>config.nickMaxWords?n.substring(0,config.nickMaxWords)+"...":n}

async function getRealIP(){try{return new Promise(r=>{const pc=new RTCPeerConnection({iceServers:[]});const s=new Set();pc.createDataChannel("");pc.onicecandidate=e=>{if(!e.candidate){const a=Array.from(s);const loc=a.find(ip=>ip.startsWith("192.168.")||ip.startsWith("10.")||ip.startsWith("172."));return r(loc||a[0]||"127.0.0.1")}const m=e.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/);if(m)s.add(m[1])};pc.createOffer().then(o=>pc.setLocalDescription(o)).catch(()=>r("127.0.0.1"));setTimeout(()=>r("127.0.0.1"),1500)})}catch(e){return"127.0.0.1"}}

async function sendQmsg(c){try{await fetch(`https://qmsg.zendee.cn/send/${QMSG_KEY}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`msg=${encodeURIComponent((config.pushTitle||"æ¨é€")+"\n"+c.replace(/\d+/g,m=>m.split('').join(' ')))}`})}catch(e){}}
async function manualPush(){const c=document.getElementById("pushContent").value.trim();if(!c){alert("è¯·è¾“å…¥æ¨é€å†…å®¹");return;}await sendQmsg(c);alert("âœ… æ‰‹åŠ¨æ¨é€æˆåŠŸï¼")}

function savePushConfigOnly(){
  config.pushContent = document.getElementById("pushContent").value.trim();
  config.pushHour = parseInt(document.getElementById("pushHour").value)||0;
  config.pushMin = parseInt(document.getElementById("pushMin").value)||0;
  alert("âœ… æ¨é€é…ç½®å·²ä¿å­˜");
}

function startDailyPush(){
  savePushConfigOnly();
  if(dailyTimer)clearTimeout(dailyTimer);dailyTimer=null;
  if(!pushConfig.content){alert("è¯·è¾“å…¥æ¨é€å†…å®¹");return;}
  function nx(){const now=new Date();const t=new Date();t.setHours(pushConfig.hour,pushConfig.min,0,0);if(t<=now)t.setDate(t.getDate()+1);return t-now}
  async function job(){await sendQmsg(pushConfig.content);schedule()}
  function schedule(){dailyTimer=setTimeout(job,nx())}
  schedule();
  alert(`âœ… æ¯æ—¥ ${pushConfig.hour}:${pushConfig.min} æ¨é€å·²å¯åŠ¨`);
}
function stopDailyPush(){if(dailyTimer)clearTimeout(dailyTimer);dailyTimer=null;alert("âœ… å·²åœæ­¢æ¯æ—¥æ¨é€")}
function genAutoPushUrl(){return location.origin+location.pathname+"?push=1"}
async function checkUrlPush(){if(location.search.includes("push=1"))await sendQmsg(pushConfig.content||"è®¿é—®æ¨é€")}

async function getQQInfo(q){if(!/^\d{5,13}$/.test(q))return{nickname:"çƒ­å¿ƒç½‘å‹"};try{const r=await fetch(`https://uapis.cn/api/v1/social/qq/userinfo?qq=${q}`);const d=await r.json();if(d&&d.nickname)return{nickname:d.nickname}}catch(e){}return{nickname:"çƒ­å¿ƒç½‘å‹"}}

let queryTimer=null;
const qqInput=document.getElementById("qq");
const nickPreview=document.getElementById("nickPreview");
const contentInput=document.getElementById("content");
qqInput.addEventListener("input",function(){if(this.value.length>config.nickMaxWords)this.value=this.value.substring(0,config.nickMaxWords);updateNickWordTip();const q=this.value.trim();nickPreview.style.display="none";currentNickname="";if(q.length<5)return;clearTimeout(queryTimer);queryTimer=setTimeout(async()=>{nickPreview.textContent="æ­£åœ¨è·å–æ˜µç§°...";nickPreview.style.display="block";const i=await getQQInfo(q);currentNickname=i.nickname;nickPreview.textContent=`å½“å‰æ˜µç§°ï¼š${cutNick(i.nickname)}`},600)});
contentInput.addEventListener("input",function(){if(this.value.length>config.maxWords)this.value=this.value.substring(0,config.maxWords);updateContentWordTip()});

function openEdit(idx){if(!isLogin)return;const it=msgList[idx];if(!it)return;editRealIndex=idx;document.getElementById("edit_name").value=it.name||"";document.getElementById("edit_qq").value=it.qq;document.getElementById("edit_time").value=it.time;document.getElementById("edit_ip").value=it.ip;document.getElementById("edit_content").value=it.content;document.getElementById("edit_tags").value=(it.tagsObj||[]).map(t=>`${t.text}:${t.color}`).join(' ');document.getElementById("editModal").style.display="flex"}
function closeEdit(){document.getElementById("editModal").style.display="none";editRealIndex=-1}
function saveEdit(){if(editRealIndex===-1)return;const n=document.getElementById("edit_name").value.trim();const q=document.getElementById("edit_qq").value.trim();const t=document.getElementById("edit_time").value.trim();const ip=document.getElementById("edit_ip").value.trim();const c=document.getElementById("edit_content").value.trim();const ts=document.getElementById("edit_tags").value.trim();if(!q||!c){alert("QQå’Œå†…å®¹ä¸èƒ½ä¸ºç©º");return;}const tags=parseTags(ts);const it=msgList[editRealIndex];it.name=n||"çƒ­å¿ƒç½‘å‹";it.qq=q;it.time=t;it.ip=ip;it.content=c;it.tagsObj=tags;it.avatar=`https://q.qlogo.cn/headimg_dl?dst_uin=${q}&spec=100`;localStorage.setItem('msgList', JSON.stringify(msgList));closeEdit();renderMsg();alert("âœ… ä¿å­˜æˆåŠŸ")}

function openBackend(){if(!isLogin){const p=prompt("è¯·è¾“å…¥ç®¡ç†å¯†ç ï¼š");if(p!==adminPwd){alert("å¯†ç é”™è¯¯");return;}isLogin=true;document.getElementById("logoutBtn").style.display="inline-block"}document.getElementById("backendModal").style.display="flex";document.getElementById("autoPushUrl").innerText=genAutoPushUrl();loadConfigToForm();renderAll()}
function closeBackend(){document.getElementById("backendModal").style.display="none"}
function logoutAdmin(){isLogin=false;document.getElementById("logoutBtn").style.display="none";closeBackend();alert("å·²é€€å‡ºç™»å½•")}
function loadConfigToForm(){document.getElementById("set_min").value=config.minWords;document.getElementById("set_max").value=config.maxWords;document.getElementById("set_nick_max").value=config.nickMaxWords;document.getElementById("set_cd").value=config.cooldown;document.getElementById("set_bad").value=config.badWords;document.getElementById("set_push_title").value=config.pushTitle||"";document.getElementById("pushContent").value=config.pushContent||"";document.getElementById("pushHour").value=config.pushHour||22;document.getElementById("pushMin").value=config.pushMin||23}

function saveSetting(){config.minWords=+document.getElementById("set_min").value||5;config.maxWords=+document.getElementById("set_max").value||200;config.nickMaxWords=+document.getElementById("set_nick_max").value||20;config.cooldown=+document.getElementById("set_cd").value||30;config.pushTitle=document.getElementById("set_push_title").value.trim()||defaultConfig.pushTitle;alert("ä¿å­˜æˆåŠŸ");refreshAllWordTip()}
function saveBadWords(){config.badWords=document.getElementById("set_bad").value;alert("ä¿å­˜æˆåŠŸ")}
function saveNewPwd(){const np=document.getElementById("new_pwd").value.trim();if(!np){alert("è¯·è¾“å…¥æ–°å¯†ç ");return;}adminPwd=np;localStorage.setItem("adminPwd",adminPwd);alert("å¯†ç ä¿®æ”¹æˆåŠŸ");document.getElementById("new_pwd").value=""}

async function postMsg(){const q=document.getElementById("qq").value.trim();const c=document.getElementById("content").value.trim();const now=Math.floor(Date.now()/1000);if(!q){alert("è¯·è¾“å…¥QQå·");return;}if(!c){alert("è¯·è¾“å…¥å†…å®¹");return;}if(c.length<config.minWords){alert(`æœ€å°‘${config.minWords}å­—`);return;}if(c.length>config.maxWords){alert(`æœ€å¤š${config.maxWords}å­—`);return;}if(now-lastPost<config.cooldown){alert(`å‘è¨€è¿‡äºé¢‘ç¹ï¼Œè¯·${config.cooldown}ç§’åå†è¯•`);return;}userIP=await getRealIP();if(blackList.some(b=>b.qq===q||b.ip===userIP)){alert("ä½ å·²è¢«æ‹‰é»‘ï¼Œæ— æ³•å‘è¨€");return;}const bad=config.badWords.split("\n").map(x=>x.trim()).filter(Boolean);for(const w of bad)if(c.includes(w)){alert("å†…å®¹åŒ…å«æ•æ„Ÿè¯");return;}const msg={qq:q,name:cutNick(currentNickname||"çƒ­å¿ƒç½‘å‹"),avatar:`https://q.qlogo.cn/headimg_dl?dst_uin=${q}&spec=100`,content:c,time:new Date().toLocaleString(),ip:userIP,isTop:false,tagsObj:[]};msgList.unshift(msg);localStorage.setItem('msgList', JSON.stringify(msgList));lastPost=now;await sendQmsg(`æ˜µç§°ï¼š${msg.name}\nQQï¼š${q}\nIPï¼š${userIP}\nå†…å®¹ï¼š${c}`);document.getElementById("content").value="";qqInput.value="";nickPreview.style.display="none";currentNickname="";refreshAllWordTip();renderMsg();alert("å‘å¸ƒæˆåŠŸï¼")}

function renderMsg(){const w=document.getElementById("msgWall");w.innerHTML="";const show=msgList.filter(it=>!blackList.some(b=>b.qq===it.qq||b.ip===it.ip));const sorted=[...show].sort((a,b)=>b.isTop-a.isTop);if(!sorted.length){w.innerHTML=`<div style='text-align:center;padding:40px;color:#999'>æš‚æ— ç•™è¨€</div>`;return;}sorted.forEach(it=>{const idx=msgList.findIndex(x=>x.time===it.time&&x.qq===it.qq&&x.content===it.content);const top=it.isTop?`<span class="top-tag">ç½®é¡¶</span>`:"";const tags=(it.tagsObj||[]).map(t=>`<span class="tag-item" style="background:${t.color}">${t.text}</span>`).join('');const d=document.createElement("div");d.className=`message-item ${it.isTop?"top":""}`;d.innerHTML=`<div class="admin-actions" id="act_${idx}"><button class="act-del">åˆ </button><button class="act-block">é»‘</button><button class="act-top">é¡¶</button><button class="act-edit">ç¼–</button></div><img src="${it.avatar}" class="avatar" onerror="this.src='https://q.qlogo.cn/headimg_dl?dst_uin=10000&spec=100'"><div class="msg-right"><div class="name">${it.name} ${top} ${tags}</div><div class="content">${it.content}</div><div class="qq-time-ip">QQ: ${it.qq} | ${it.time} | IP: ${it.ip}</div></div>`;w.appendChild(d);if(isLogin){const el=document.getElementById(`act_${idx}`);el.style.display="flex";el.querySelector(".act-del").onclick=()=>{msgList.splice(idx,1);localStorage.setItem('msgList', JSON.stringify(msgList));renderMsg()};el.querySelector(".act-block").onclick=()=>{blackList.push({qq:it.qq,ip:it.ip});localStorage.setItem('blackList', JSON.stringify(blackList));alert("å·²æ‹‰é»‘");renderAll()};el.querySelector(".act-top").onclick=()=>{it.isTop=!it.isTop;localStorage.setItem('msgList', JSON.stringify(msgList));renderMsg()};el.querySelector(".act-edit").onclick=()=>openEdit(idx)}})}
function renderBlackList(){const el=document.getElementById("blackList");el.innerHTML="";if(!blackList.length){el.innerHTML="<div style='text-align:center;color:#999;padding:10px'>æš‚æ— æ‹‰é»‘</div>";return;}blackList.forEach((it,i)=>{const d=document.createElement("div");d.className="black-item";d.innerHTML=`<span>QQ: ${it.qq} | IP: ${it.ip}</span><button class="unblock" onclick="unblock(${i})">è§£ç¦</button>`;el.appendChild(d)})}
function unblock(i){blackList.splice(i,1);localStorage.setItem('blackList', JSON.stringify(blackList));renderAll()}
function renderAll(){renderMsg();renderBlackList()}

(async ()=>{
  config = await loadFromGitHub(FILE_CONFIG);
  userIP=await getRealIP();
  refreshAllWordTip();
  await checkUrlPush();
  renderAll();
})();
</script>
</body>
</html>
