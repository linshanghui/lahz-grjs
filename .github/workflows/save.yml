name: Test Save
on:
  workflow_dispatch:
    inputs:
      minWords:
        description: 'æœ€å°‘å­—æ•°'
        required: true
        default: '10'

jobs:
  test_save:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.TOKEN }}
          ref: main

      - name: è¯»å–æˆ–åˆ›å»ºé…ç½®
        id: read_config
        run: |
          # å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºä¸€ä¸ªé»˜è®¤é…ç½®
          if [ ! -f "msg_config.json" ]; then
            echo '{"minWords":5,"maxWords":200,"nickMaxWords":20,"cooldown":30,"badWords":"æ“\nå‚»é€¼\nå¦ˆçš„\nåƒåœ¾\næ»š","pushTitle":"ğŸ“¢ ç•™è¨€å¢™æœ‰äººç•™è¨€å•¦"}' > msg_config.json
          fi
          # è¯»å–é…ç½®å†…å®¹
          CONFIG=$(cat msg_config.json)
          echo "config=$CONFIG" >> $GITHUB_OUTPUT

      - name: ä¿®æ”¹é…ç½®
        run: |
          # ä½¿ç”¨ Node.js æ¥ä¿®æ”¹ JSONï¼Œé¿å…ä¾èµ– jq
          NEW_MIN_WORDS=${{ github.event.inputs.minWords }}
          node -e "
            const fs = require('fs');
            const config = JSON.parse(fs.readFileSync('msg_config.json', 'utf8'));
            config.minWords = parseInt('$NEW_MIN_WORDS');
            fs.writeFileSync('msg_config.json', JSON.stringify(config, null, 2));
          "

      - name: æäº¤å¹¶æ¨é€
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@noreply.github.com"
          git add msg_config.json
          git commit -m "æ›´æ–°é…ç½® [skip ci]"
          git push origin main
